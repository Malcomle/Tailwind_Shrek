<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title>Shrek</title>
  <meta content="" name="description">
  <link href="css/main.css" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>

  <script>
      tailwind.config = {
          theme: {
              extend: {
                  colors: {
                      creme: '#e1dfb6',
                      marron: '#5c452d',
                      light_shrek: '#c5ee7d',
                      medium_shrek: '#8cb04e',
                      shrek: '#7a9244'
                  },
                  fontFamily: {
                      shrek: ["shrek", "cursive"],
                  },
              }
          }
      }
  </script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
<header>
  <nav class="bg-creme px-2 sm:px-4 py-2.5 w-full z-20 top-0 left-0 border-b border-gray-200">
    <div class="container flex flex-wrap justify-between items-center mx-auto">
      <a class="flex items-center" href="index.html">
        <img alt="Flowbite Logo" class="mr-3 h-6 sm:h-9" src="img/logo.svg">
        <span class="self-center text-xl font-shrek text-shrek whitespace-nowrap">Shrek Wiki</span>
      </a>
      <div class="flex md:order-2">
        <a href="https://shrek.fandom.com/wiki/Shrek_(character)">
          <button class="text-light_shrek bg-marron hover:font-extrabold focus:ring-4 focus:outline-none focus:ring-shrek font-medium rounded-lg text-sm px-5 py-2.5 text-center mr-3 md:mr-0"
                  type="submit">
            Wiki Officiel
          </button>
        </a>
        <button aria-controls="navbar-sticky" aria-expanded="false"
                class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
                data-collapse-toggle="navbar-sticky" type="button">
          <span class="sr-only">Open main menu</span>
          <svg aria-hidden="true" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"
               xmlns="http://www.w3.org/2000/svg">
            <path clip-rule="evenodd"
                  d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                  fill-rule="evenodd"></path>
          </svg>
        </button>
      </div>
      <div class="hidden justify-between items-center w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
        <ul class="flex flex-col p-4 mt-4 rounded-lg md:flex-row md:space-x-8 md:mt-0 md:text-sm md:font-medium md:border-0">
          <li>
            <a aria-current="page"
               class="block py-2 pr-4 pl-3 text-marron rounded md:hover:text-medium_shrek md:p-0"
               href="index.html">Home</a>
          </li>
          <li>
            <a class="block py-2 pr-4 pl-3 text-marron rounded md:hover:text-medium_shrek md:p-0"
               href="questionnaire.html">Ajout de personnage</a>
          </li>
          <li>
            <a class="block py-2 pr-4 pl-3 text-shrek font-bold rounded hover:text-medium_shrek md:p-0"
               href="#">Galerie</a>
          </li>
          <li>
            <a class="block py-2 pr-4 pl-3 text-marron rounded md:hover:text-medium_shrek md:p-0"
               href="table.html">Personnages</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
<section>
  <div class="flex space-x-2 justify-center mt-5">
    <input class="form-control
          block
          w-1/4
          px-3
          py-1.5
          bg-clip-padding
          border border-solid border-gray-300
          rounded-xl
          ease-in-out
          m-0
          focus:border-light_shrek focus:outline-none" id="link"
           placeholder="exemple : https://monImage.jpg" type="text">
    <button class="inline-block px-6 py-2.5 bg-shrek text-white font-medium text-xs leading-tight uppercase rounded shadow-md hover:bg-marron hover:shadow-lg  transition duration-150 ease-in-out"
            id='buttoned'
            type="button">
      Ajoute ta photo
    </button>
  </div>
</section>
<section class="overflow-hidden text-gray-700  mt-5">
  <div class="container px-5 py-2 mx-auto lg:pt-12 lg:px-32">
    <div class="flex flex-wrap -m-1 md:-m-2" id="gallery"></div>
  </div>
</section>
<footer class="p-4 bg-creme rounded-lg shadow md:flex md:items-center md:justify-between md:p-6">
    <span class="text-sm text-marron sm:text-center">© 2022 <a class="hover:underline text-medium_shrek"
                                                               href="https://flowbite.com/">Shrek™</a>. Tout droit réservé.
    </span>
  <ul class="flex flex-wrap items-center mt-3 text-sm text-marron sm:mt-0">
    <li>
      <a class="mr-4 hover:underline md:mr-6 " href="index.html">Home</a>
    </li>
    <li>
      <a class="mr-4 hover:underline md:mr-6" href="questionnaire.html">Ajout de personnage</a>
    </li>
    <li>
      <a class="mr-4 hover:underline md:mr-6" href="gallery.html">Galerie</a>
    </li>
    <li>
      <a class="hover:underline" href="table.html">Personnages</a>
    </li>
  </ul>
</footer>
</body>

<script type="module">
    import {initializeApp} from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
    import {
        getFirestore,
        collection,
        getDocs,
        addDoc,
    } from 'https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js'

    // Your web app's Firebase configuration
    export const firebaseConfig = {
        apiKey: "AIzaSyBbREiytmy8a1ZCRl61_uili9NTvPUEDOA",
        authDomain: "shrekgallery-cf7c7.firebaseapp.com",
        projectId: "shrekgallery-cf7c7",
        storageBucket: "shrekgallery-cf7c7.appspot.com",
        messagingSenderId: "841518763625",
        appId: "1:841518763625:web:86718b71d78556160d1cf8"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Get a list of cities from your database
    export async function getCities(db) {
        const shrek = collection(db, 'shrek');
        let resShrek = await getDocs(shrek);
        return resShrek.docs.map(doc => doc.data());
    }

    function addDiv(link) {
        let doc = document.createElement('div')
        doc.id = 'imgs'
        doc.classList = 'flex-wrap w-1/3'
        let gallery = document.querySelector('#gallery')
        doc.innerHTML =
            '          <div class="w-full h-80 p-1 md:p-2">\n' +
            '            <img alt="gallery" class="block object-cover object-center w-full h-full rounded-lg"\n' +
            '                 src=' + link + '>\n' +
            '          </div>\n' +
            '        '

        gallery.appendChild(doc)
    }

    async function sendPicture() {
        let link = document.querySelector('#link').value
        if (link == '') {
            alert('L\' url est vide')
            return
        }
        try {
            const docRef = await addDoc(collection(db, "shrek"), {
                shrek: link,
            });
            console.log("Document envoyé: ", docRef.id);
        } catch (e) {
            console.error("Error : ", e);
        }
    }

    let cities = await getCities(db);

    cities.forEach(x => {
        addDiv(x['shrek'])
    })

    document.querySelector('#buttoned').addEventListener('click', sendPicture)

    let divImg = document.querySelectorAll('#imgs')
    divImg.forEach(div => {
        let img = div.querySelector('img')
        img.onerror = function () {
            div.remove()
            return true;
        }
    })
</script>
